<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upgrade Simulator</title>
</head>
<body>
    <h1>Upgrade Simulator</h1>
    <script>
        function simulateUpgrade() {
            var maxTries = 7;
            var maxBonus = 0.45;
            var bonusIncrement = 0.05;

            var equipmentLevel = 0;
            var bonusRate = 0.0;
            var failedAttempts = 0;
            var stoneUses = 0;
            var scrollUses = 0;

            while (equipmentLevel < 5) {
                if (failedAttempts >= maxTries) {
                    var useScroll = prompt("失敗次數已達上限，是否使用扣除卷軸？(yes/no)").trim().toLowerCase();
                    while (useScroll === 'yes') {
                        if (Math.random() < 0.30) {
                            alert("使用扣除卷軸成功，扣除1次超越失敗次數");
                            failedAttempts -= 1;
                            scrollUses += 1;
                            break;
                        } else {
                            alert("使用扣除卷軸失敗，請重新嘗試。");
                            useScroll = prompt("是否再次使用扣除卷軸？(yes/no)").trim().toLowerCase();
                            scrollUses += 1;
                        }
                    }
                    if (useScroll !== 'yes') {
                        alert("超越失敗次數已達上限，無法繼續超越。");
                        break;
                    }
                }

                var stoneChoice = prompt("請選擇超越石:\n1. 30%的超越石\n2. 6%的超越石").trim();
                var successRate, stoneType;
                if (stoneChoice === '1') {
                    successRate = 0.30;
                    stoneType = "30%的超越石";
                    stoneUses += 1;
                } else if (stoneChoice === '2') {
                    successRate = 0.06;
                    stoneType = "6%的超越石";
                    stoneUses += 1;
                } else {
                    alert("請輸入有效的選擇(1或2)。");
                    continue;
                }

                successRate += bonusRate;

                if (Math.random() < successRate) {
                    equipmentLevel += 1;
                    alert("成功使用" + stoneType + "，當前等級: " + equipmentLevel);
                    bonusRate = 0.0;
                } else {
                    failedAttempts += 1;
                    bonusRate = Math.min(bonusRate + bonusIncrement, maxBonus);
                    alert("失敗使用" + stoneType + "，當前輔助機率: " + bonusRate.toFixed(2));
                }

                alert("當前超越失敗次數: " + failedAttempts + "/" + maxTries);
            }

            if (equipmentLevel === 5) {
                alert("成功達到等級5\n超越石使用次數: " + stoneUses + "\n扣除卷軸使用次數: " + scrollUses);
            } else {
                alert("最終等級: " + equipmentLevel);
            }
        }

        simulateUpgrade();
    </script>
</body>
</html>
